<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Şifre Değiştir - Saha Gözlem</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body style="background: linear-gradient(135deg, #032f0c 0%, #1e5a2b 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">
  <div style="background: white; border-radius: 24px; padding: 48px; max-width: 420px; margin: 16px; width: 100%; box-sizing: border-box;">
    <div style="text-align: center; margin-bottom: 32px;">
      <h1 style="color: #032f0c; font-size: 28px; font-weight: 800; margin-bottom: 8px;">Şifre Değiştir</h1>
      <p style="color: #6b7280; font-size: 14px;">Kullanıcı: {{ current_user }}</p>
    </div>
    
    {% set error_param = request.query_params.get('error') %}
    {% if error_param %}
      <div style="background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; padding: 12px 16px; border-radius: 12px; margin-bottom: 24px; text-align: center; font-size: 14px;">{{ error_param }}</div>
    {% endif %}
    
    <form method="post" action="/change-password" id="changePasswordForm">
      <input type="hidden" name="current_user" value="{{ current_user }}">
      
      <!-- Mevcut Şifre -->
      <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Mevcut Şifre</label>
      <input type="password" name="old_password" id="oldPassword" required placeholder="Mevcut şifrenizi girin" 
             style="width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 16px; font-size: 16px; margin-bottom: 20px; box-sizing: border-box;">
      
      <!-- Yeni Şifre -->
      <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Yeni Şifre</label>
      <input type="password" name="new_password" id="newPassword" required placeholder="Yeni şifrenizi girin" minlength="4"
             style="width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 16px; font-size: 16px; margin-bottom: 20px; box-sizing: border-box;">
      
      <!-- Yeni Şifre Tekrar -->
      <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Yeni Şifre (Tekrar)</label>
      <input type="password" name="confirm_password" id="confirmPassword" required placeholder="Yeni şifrenizi tekrar girin" minlength="4"
             style="width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 16px; font-size: 16px; margin-bottom: 24px; box-sizing: border-box;">
      
      <!-- Şifre Gücü Göstergesi -->
      <div style="margin-bottom: 24px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
          <span style="font-size: 12px; color: #6b7280;">Şifre Gücü</span>
          <span id="strengthText" style="font-size: 12px; color: #6b7280;">-</span>
        </div>
        <div style="height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
          <div id="strengthBar" style="height: 100%; width: 0%; background: #dc2626; transition: all 0.3s ease; border-radius: 2px;"></div>
        </div>
      </div>
      
      <!-- Butonlar -->
      <div style="display: flex; gap: 12px;">
        <button type="submit" id="changeButton" disabled style="flex: 1; background: linear-gradient(135deg, #032f0c 0%, #1e5a2b 100%); color: white; border: none; padding: 18px; border-radius: 16px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.2s ease; opacity: 0.5;">
          Şifre Değiştir
        </button>
        <a href="/login" style="flex: 0 0 auto; background: #f3f4f6; color: #374151; border: none; padding: 18px 24px; border-radius: 16px; font-size: 16px; font-weight: 700; text-decoration: none; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;">
          İptal
        </a>
      </div>
    </form>
  </div>
  
  <style>
    /* Hover efektleri */
    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(3,47,12,0.3);
    }
    
    button:active:not(:disabled) {
      transform: translateY(0);
    }
    
    a:hover {
      background: #e5e7eb !important;
    }
    
    /* Focus efektleri */
    input:focus, select:focus {
      border-color: #032f0c !important;
      outline: none !important;
      box-shadow: 0 0 0 3px rgba(3,47,12,0.1) !important;
    }
    
    /* Disabled button */
    button:disabled {
      cursor: not-allowed !important;
      opacity: 0.5 !important;
    }
    
    button:not(:disabled) {
      opacity: 1 !important;
    }
    
    /* Loading durumu */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }
    
    /* Responsive design */
    @media (max-width: 480px) {
      body > div {
        padding: 32px 24px !important;
        margin: 8px !important;
        max-width: none !important;
      }
      
      h1 {
        font-size: 24px !important;
        margin-bottom: 8px !important;
      }
      
      input, select {
        padding: 14px !important;
        font-size: 15px !important;
      }
      
      button, a {
        padding: 16px !important;
        font-size: 15px !important;
      }
      
      .button-row {
        flex-direction: column !important;
        gap: 8px !important;
      }
    }
  </style>
  
  <script>
    // Şifre gücü hesaplama
    function calculatePasswordStrength(password) {
      if (!password) return 0;
      
      let score = 0;
      
      // Uzunluk kontrolü
      if (password.length >= 8) score += 25;
      else if (password.length >= 6) score += 15;
      else if (password.length >= 4) score += 10;
      
      // Büyük harf
      if (/[A-Z]/.test(password)) score += 20;
      
      // Küçük harf  
      if (/[a-z]/.test(password)) score += 20;
      
      // Rakam
      if (/\d/.test(password)) score += 20;
      
      // Özel karakter
      if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\?]/.test(password)) score += 15;
      
      return Math.min(score, 100);
    }
    
    function updatePasswordStrength() {
      const password = document.getElementById('newPassword').value;
      const score = calculatePasswordStrength(password);
      const strengthBar = document.getElementById('strengthBar');
      const strengthText = document.getElementById('strengthText');
      
      // Görsel güncelleme
      strengthBar.style.width = score + '%';
      
      if (score < 30) {
        strengthBar.style.background = '#dc2626';
        strengthText.textContent = 'Zayıf';
        strengthText.style.color = '#dc2626';
      } else if (score < 60) {
        strengthBar.style.background = '#f59e0b';
        strengthText.textContent = 'Orta';
        strengthText.style.color = '#f59e0b';
      } else if (score < 80) {
        strengthBar.style.background = '#10b981';
        strengthText.textContent = 'İyi';
        strengthText.style.color = '#10b981';
      } else {
        strengthBar.style.background = '#059669';
        strengthText.textContent = 'Güçlü';
        strengthText.style.color = '#059669';
      }
    }
    
    // Şifre eşleşme kontrolü
    function checkPasswordMatch() {
      const oldPassword = document.getElementById('oldPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const changeButton = document.getElementById('changeButton');
      
      const isValid = oldPassword.length >= 1 && 
                     newPassword.length >= 4 && 
                     confirmPassword.length >= 4 && 
                     newPassword === confirmPassword;
      
      changeButton.disabled = !isValid;
      
      // Şifre eşleşmeme durumunda görsel geri bildirim
      const confirmField = document.getElementById('confirmPassword');
      if (confirmPassword.length > 0 && newPassword !== confirmPassword) {
        confirmField.style.borderColor = '#dc2626';
        confirmField.style.boxShadow = '0 0 0 3px rgba(220, 38, 38, 0.1)';
      } else {
        confirmField.style.borderColor = '#e5e7eb';
        confirmField.style.boxShadow = 'none';
      }
    }
    
    // Event listener'lar
    document.addEventListener('DOMContentLoaded', function() {
      const newPasswordField = document.getElementById('newPassword');
      const confirmPasswordField = document.getElementById('confirmPassword');
      const oldPasswordField = document.getElementById('oldPassword');
      const form = document.getElementById('changePasswordForm');
      const changeButton = document.getElementById('changeButton');
      
      // Şifre alanı değiştiğinde
      newPasswordField.addEventListener('input', function() {
        updatePasswordStrength();
        checkPasswordMatch();
      });
      
      // Şifre tekrar alanı değiştiğinde
      confirmPasswordField.addEventListener('input', checkPasswordMatch);
      
      // Eski şifre alanı değiştiğinde
      oldPasswordField.addEventListener('input', checkPasswordMatch);
      
      // Form submit edildiğinde
      form.addEventListener('submit', function() {
        changeButton.classList.add('loading');
        changeButton.textContent = 'Şifre değiştiriliyor...';
        changeButton.disabled = true;
      });
      
      // Sayfa yüklendiğinde kontrol et
      checkPasswordMatch();
    });
  </script>
</body>
</html>