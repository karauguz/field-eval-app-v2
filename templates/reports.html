{% extends "base.html" %}
{% block content %}
<div class="container mx-auto px-4 py-6">
  <div class="bg-white rounded-2xl shadow" style="padding: 16px 20px;">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-xl font-semibold">Radar Raporu - Birle≈üik Anket Analizi</h2>
      </div>

    <style>
      /* Container ve responsive d√ºzeltmeleri */
      body {
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }
      
      .container {
        max-width: 1200px;
        width: 100%;
        margin: 0 auto;
      }
      
      .date-input { 
        position: relative; 
        width: 100%;
      }
      .date-input input[type="date"]{
        width: 100%;
        min-height: 48px;
        padding: 8px 12px;
        padding-right: 40px;
        border: 1px solid #e5e7eb; 
        border-radius: 8px;
        background: #fff;
        font-size: 14px;
        box-sizing: border-box;
      }
      .date-input input[type="date"]::-webkit-date-and-time-value { text-align: left; }
      .date-input input[type="date"]::-webkit-calendar-picker-indicator{
        opacity: .75; 
        cursor: pointer;
      }
      
      .controls { 
        display: flex; 
        gap: 12px; 
        flex-wrap: wrap; 
        margin-bottom: 1rem; 
        align-items: center; 
        width: 100%;
      }
      .controls .meta { 
        margin-left: auto; 
        color: #4b5563; 
        font-size: 0.9rem;
        flex-shrink: 0;
      }
      
      /* Survey Type Info */
      .survey-type-info {
        background: linear-gradient(135deg, #11461c, #11461c);
        color: white;
        padding: 12px 16px;
        border-radius: 12px;
        margin-bottom: 16px;
        text-align: center;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      }
      
      /* Method Details */
      #methodDetails {
        background: rgba(3,47,12,0.05) !important;
        border: 1px solid rgba(3,47,12,0.2) !important;
        margin-bottom: 16px;
      }

      /* RESPONSIVE GRID LAYOUT */
      .main-content-grid {
        display: grid;
        gap: 20px;
        align-items: start;
        margin: 20px 0;
        width: 100%;
        max-width: 100%;
      }
      
      /* Desktop: Radar 3fr, Method 2fr */
      @media (min-width: 1200px) {
        .main-content-grid {
          grid-template-columns: 3fr 2fr;
          gap: 32px;
        }
      }
      
      /* Tablet: tek s√ºtun, method √ºstte */
      @media (max-width: 1199px) {
        .main-content-grid {
          grid-template-columns: 1fr;
          gap: 20px;
        }
        
        .categories-section {
          order: 1;
        }
        
        .chart-section {
          order: 2;
        }
      }

      /* Chart section - RESPONSIVE (SOL TARAF - 3FR) */
      .chart-section {
        background: #f8fafc;
        padding: 16px;
        border-radius: 16px;
        border: 3px solid #032f0c;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .chart-wrapper {
        background: white;
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .chart-title {
        text-align: center;
        font-weight: 700;
        font-size: 18px;
        color: #032f0c;
        margin-bottom: 16px;
      }
      
      /* RADAR CANVAS - RESPONSIVE */
      #radar {
        width: 100% !important;
        max-width: 100% !important;
        height: auto !important;
      }
      
      .chart-container {
        position: relative;
        width: 100%;
        height: 400px;
        max-width: 100%;
      }

      /* Categories section - RESPONSIVE (SAƒû TARAF - 2FR) */
      .categories-section {
        background: #f9fafb;
        padding: 20px;
        border-radius: 16px;
        border: 2px solid #e5e7eb;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .categories-title {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 20px;
        text-align: center;
      }

      /* Method cards - RESPONSIVE GRID */
      .method-cards-vertical {
        display: grid;
        gap: 12px;
        width: 100%;
      }
      
      /* Desktop: tek s√ºtun */
      @media (min-width: 1200px) {
        .method-cards-vertical {
          grid-template-columns: 1fr;
        }
      }
      
      /* Tablet: 2 s√ºtun */
      @media (min-width: 768px) and (max-width: 1199px) {
        .method-cards-vertical {
          grid-template-columns: repeat(2, 1fr);
        }
        
        .chart-container {
          height: 350px;
        }
      }
      
      /* Mobil: tek s√ºtun */
      @media (max-width: 767px) {
        .method-cards-vertical {
          grid-template-columns: 1fr;
        }
        
        .chart-container {
          height: 300px;
        }
      }
      
      .method-card {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
        width: 100%;
        box-sizing: border-box;
      }
      
      .method-card:hover {
        border-color: #032f0c;
        box-shadow: 0 2px 8px rgba(3,47,12,0.1);
      }
      
      .method-card.method-selected{
        border: 2px solid #032f0c;
        box-shadow: 0 2px 10px rgba(3,47,12,0.15);
        background: rgba(3,47,12,0.05);
      }
      
      .method-icon {
        font-size: 20px;
        flex-shrink: 0;
      }
      
      .method-content {
        flex: 1;
        min-width: 0;
      }
      
      .method-name {
        font-weight: 600;
        font-size: 15px;
        color: #1f2937;
        margin-bottom: 2px;
      }
      
      .method-desc {
        font-size: 13px;
        color: #6b7280;
        line-height: 1.3;
      }
      
      .method-radio {
        flex-shrink: 0;
      }
      
      .method-radio input[type="radio"] {
        width: 16px;
        height: 16px;
      }

      /* Rapor butonu stilleri */
      .btn-generate-report {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        background: linear-gradient(135deg, #185C26, #22723b);
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(24, 92, 38, 0.3);
      }
      
      .btn-generate-report:hover:not(:disabled) {
        background: linear-gradient(135deg, #144a20, #185c26);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(24, 92, 38, 0.4);
      }
      
      .btn-generate-report:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }
      
      .btn-icon {
        font-size: 16px;
      }
      
      /* Rapor modal stilleri */
      .report-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .report-modal.show {
        opacity: 1;
        visibility: visible;
      }
      
      .report-content {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 1200px;
        max-height: 90vh;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        transform: translateY(20px);
        transition: transform 0.3s ease;
      }
      
      .report-modal.show .report-content {
        transform: translateY(0);
      }
      
      .report-header {
        background: linear-gradient(135deg, #185C26, #22723b);
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .report-title {
        font-size: 20px;
        font-weight: 600;
        margin: 0;
      }
      
      .report-close {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: background 0.2s;
      }
      
      .report-close:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      
      .report-body {
        padding: 0;
        max-height: calc(90vh - 120px);
        overflow-y: auto;
      }
      
      .report-actions {
        padding: 16px 20px;
        background: #f8fafc;
        border-top: 1px solid #e5e7eb;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
      }
      
      .btn-download {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .btn-download:hover {
        background: linear-gradient(135deg, #1d4ed8, #1e40af);
        transform: translateY(-1px);
      }
      
      .btn-cancel {
        background: #6b7280;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .btn-cancel:hover {
        background: #4b5563;
      }
      
      /* Rapor i√ßerik stilleri */
      .report-section {
        padding: 20px;
        border-bottom: 1px solid #f3f4f6;
      }
      
      .report-section:last-child {
        border-bottom: none;
      }
      
      .report-section-title {
        font-size: 16px;
        font-weight: 600;
        color: #185C26;
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 2px solid #185C26;
        display: inline-block;
      }
      
      .stats-grid-report {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 20px;
      }
      
      .stat-card-report {
        background: #f8fafc;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        padding: 16px;
        text-align: center;
      }
      
      .stat-value-report {
        font-size: 24px;
        font-weight: 700;
        color: #185C26;
        margin-bottom: 4px;
      }
      
      .stat-label-report {
        font-size: 12px;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .category-performance {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 16px 0;
      }
      
      .category-chart-container {
        background: #f8fafc;
        border-radius: 12px;
        padding: 16px;
        border: 1px solid #e5e7eb;
      }
      
      .category-chart-title {
        font-weight: 600;
        color: #374151;
        margin-bottom: 12px;
        text-align: center;
      }
      
      .category-radar {
        width: 100%;
        height: 250px;
      }
      
      .visits-table {
        width: 100%;
        border-collapse: collapse;
        margin: 16px 0;
      }
      
      .visits-table th {
        background: #185C26;
        color: white;
        padding: 12px 8px;
        text-align: left;
        font-weight: 600;
        font-size: 13px;
      }
      
      .visits-table td {
        padding: 10px 8px;
        border-bottom: 1px solid #e5e7eb;
        font-size: 13px;
      }
      
      .visits-table tr:nth-child(even) {
        background: #f8fafc;
      }
      
      .performance-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-align: center;
      }
      
      .badge-excellent {
        background: #dcfce7;
        color: #166534;
      }
      
      .badge-good {
        background: #fef3c7;
        color: #92400e;
      }
      
      .badge-needs-improvement {
        background: #fee2e2;
        color: #991b1b;
      }
      
      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
        font-size: 16px;
        color: #6b7280;
      }
      
      .trend-indicator {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }
      
      .trend-positive {
        background: #dcfce7;
        color: #166534;
      }
      
      .trend-negative {
        background: #fee2e2;
        color: #991b1b;
      }
      
      .trend-stable {
        background: #f3f4f6;
        color: #4b5563;
      }

      /* MOBƒ∞L RESPONSIVE */
      @media (max-width: 768px) {
        body {
          font-size: 14px;
        }
        
        .controls {
          flex-direction: column;
          gap: 8px;
          align-items: stretch;
        }
        
        .controls .meta {
          margin-left: 0;
          text-align: center;
          margin-top: 8px;
        }
        
        .method-card {
          flex-direction: row;
          padding: 12px;
          gap: 10px;
        }
        
        .method-name {
          font-size: 14px;
        }
        
        .method-desc {
          font-size: 12px;
        }
        
        .chart-title {
          font-size: 16px;
        }
        
        .categories-title {
          font-size: 16px;
        }
        
        .date-input input[type="date"] {
          font-size: 13px;
          padding: 6px 10px;
          padding-right: 35px;
          min-height: 42px;
        }
        
        .date-input label {
          font-size: 13px;
        }
      }
      
      /* ULTRA K√ú√á√úK EKRANLAR */
      @media (max-width: 480px) {
        .chart-container {
          height: 280px;
        }
        
        .method-card {
          padding: 10px;
          gap: 8px;
        }
        
        .method-icon {
          font-size: 18px;
        }
        
        .method-name {
          font-size: 13px;
        }
        
        .method-desc {
          font-size: 11px;
        }
      }
      
      /* Grid sistem d√ºzeltmeleri */
      .grid {
        display: grid;
        width: 100%;
        max-width: 100%;
      }
      
      .gap-4 {
        gap: 1rem;
      }
      
      .gap-3 {
        gap: 0.75rem;
      }
      
      .grid-cols-2 {
        grid-template-columns: 1fr 1fr;
      }
      
      @media (min-width: 768px) {
        .md\\:grid-cols-2 {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }
      
      /* Input ve select responsive */
      select, input[type="date"] {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
    </style>

    <!-- Survey Type Bilgi Kutusu -->
    <div class="survey-type-info">
      Bu rapor t√ºm anket t√ºrlerini (Eczane + Doktor) birle≈ütirip (5 kategori) g√∂sterir
    </div>

    <!-- Ana kontroller -->
    <div class="grid md:grid-cols-2 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium">Temsilci</label>
        <select id="rep" class="mt-1 w-full border rounded px-3 py-2" style="min-height: 48px;">
          <option value="" disabled selected>Temsilci se√ßiniz</option>
        </select>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div class="date-input">
          <label class="block text-sm font-medium text-gray-700">Ba≈ülangƒ±√ß</label>
          <input id="from" type="date" class="mt-1">
        </div>
        <div class="date-input">
          <label class="block text-sm font-medium text-gray-700">Biti≈ü</label>
          <input id="to" type="date" class="mt-1">
        </div>
      </div>
    </div>

    <!-- √úst bilgi/meta -->
    <div class="controls">
      <div class="meta" id="meta">Temsilci se√ßin.</div>
    </div>

    <!-- Method Details -->
    <div id="methodDetails" class="hidden mb-4 p-4 bg-blue-50 rounded-xl">
      <div class="flex items-center gap-2 mb-2">
        <span class="text-blue-600 font-semibold" id="methodTitle">Y√∂ntem Bilgisi</span>
      </div>
      <div id="methodDescription" class="text-sm text-blue-700"></div>
      <div id="trendInfo" class="hidden mt-3 p-3 bg-white rounded-lg">
        <div class="grid md:grid-cols-2 gap-4 text-sm">
          <div>
            <strong>ƒ∞lk D√∂nem:</strong> <span id="earlyPeriod">-</span><br>
            <strong>Son D√∂nem:</strong> <span id="recentPeriod">-</span>
          </div>
          <div>
            <strong>Toplam Geli≈üim:</strong> <span id="overallImprovement">-</span><br>
            <strong>En ƒ∞yi Geli≈üen:</strong> <span id="bestImproved">-</span>
          </div>
        </div>
      </div>
      <div id="targetInfo" class="hidden mt-3 p-3 bg-white rounded-lg">
        <div class="text-sm">
          <strong>Ortalama Hedef Ba≈üarƒ±sƒ±:</strong> <span id="avgAchievement">-</span><br>
          <strong>Hedefe Ula≈üan Kategoriler:</strong> <span id="categoriesAtTarget">-</span>
        </div>
      </div>
    </div>

    <!-- Ana ƒ∞√ßerik: Radar SOL (3fr) + Method SAƒû (2fr) -->
    <div class="main-content-grid">
      
      <!-- Chart Section - SOL TARAF (3fr) -->
      <div class="chart-section">
        <div class="chart-wrapper">
          <div class="chart-title" id="chartTitle">Birle≈üik Radar Grafiƒüi</div>
          <div class="chart-container">
            <canvas id="radar"></canvas>
          </div>
        </div>
<div style="display: flex; justify-content: flex-end; margin-top: 20px;">
  <button id="generateReportBtn" class="btn-generate-report" disabled>
    <span class="btn-icon">üìä</span>
    <span class="btn-text">Detaylƒ± Rapor Olu≈ütur</span>
  </button>
</div>

      </div>


      <!-- Method Selection - SAƒû TARAF (2fr) -->
      <div class="categories-section">
        <div class="categories-title">Hesaplama Y√∂ntemi</div>
        <div class="method-cards-vertical">
          <div class="method-card" data-method="recent">
            <div class="method-icon">üìà</div>
            <div class="method-content">
              <div class="method-name">Mevcut Durum</div>
              <div class="method-desc">Son 7 anketin ortalamasƒ± (birle≈üik)</div>
            </div>
            <div class="method-radio">
              <input type="radio" name="method" value="recent" id="method-recent" checked>
            </div>
          </div>
          <div class="method-card" data-method="trend">
            <div class="method-icon">üìä</div>
            <div class="method-content">
              <div class="method-name">Geli≈üim Trendi</div>
              <div class="method-desc">ƒ∞lk vs son kar≈üƒ±la≈ütƒ±rma (birle≈üik)</div>
            </div>
            <div class="method-radio">
              <input type="radio" name="method" value="trend" id="method-trend">
            </div>
          </div>
          <div class="method-card" data-method="weighted">
            <div class="method-icon">‚öñÔ∏è</div>
            <div class="method-content">
              <div class="method-name">Tarih Aƒüƒ±rlƒ±klƒ±</div>
              <div class="method-desc">Yeni anketler daha aƒüƒ±r (birle≈üik)</div>
            </div>
            <div class="method-radio">
              <input type="radio" name="method" value="weighted" id="method-weighted">
            </div>
          </div>
          <div class="method-card" data-method="target">
            <div class="method-icon">üéØ</div>
            <div class="method-content">
              <div class="method-name">Hedefe Yakƒ±nlƒ±k</div>
              <div class="method-desc">Belirlenen hedeflere g√∂re</div>
            </div>
            <div class="method-radio">
              <input type="radio" name="method" value="target" id="method-target">
            </div>
          </div>
          <div class="method-card" data-method="traditional">
            <div class="method-icon">üìã</div>
            <div class="method-content">
              <div class="method-name">Geleneksel</div>
              <div class="method-desc">T√ºm ge√ßmi≈ü anketler (birle≈üik)</div>
            </div>
            <div class="method-radio">
              <input type="radio" name="method" value="traditional" id="method-traditional">
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>

<!-- Rapor Modal -->
<div id="reportModal" class="report-modal">
  <div class="report-content">
    <div class="report-header">
      <h3 class="report-title" id="reportModalTitle">Detaylƒ± Performans Raporu</h3>
      <button class="report-close" onclick="closeReportModal()">&times;</button>
    </div>
    <div class="report-body" id="reportBody">
      <div class="loading-spinner">
        <div>Rapor olu≈üturuluyor...</div>
      </div>
    </div>
    <div class="report-actions">
      <button class="btn-cancel" onclick="closeReportModal()">Kapat</button>
      <button class="btn-download" id="downloadReportBtn" onclick="downloadReport()" disabled>
        <span>üìÑ</span>
        PDF ƒ∞ndir
      </button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Jinja deƒüi≈ükenlerini g√ºvenli ≈üekilde parse et
const MAP = JSON.parse('{{ mgr_to_reps | tojson | safe }}');
const ORDER = JSON.parse('{{ radar_order | tojson | safe }}');
const CURRENT_MANAGER = '{{ current_user | safe }}';

// Doktor kategorilerini kullan (5 kategori) - birle≈üik sistem i√ßin
const COMBINED_CATEGORIES = ["M√º≈üteri Odaklƒ±lƒ±k", "√ñƒürenme √áevikliƒüi", "Sonu√ß √áevikliƒüi", "Ki≈üisel Farkƒ±ndalƒ±k", "Deƒüi≈üim √áevikliƒüi"];

const selRep = document.getElementById('rep');
const inpF   = document.getElementById('from');
const inpT   = document.getElementById('to');
const meta   = document.getElementById('meta');
const methodDetails = document.getElementById('methodDetails');
const chartTitle = document.getElementById('chartTitle');
const generateReportBtn = document.getElementById('generateReportBtn');

const methodCards  = document.querySelectorAll('.method-card');
const methodRadios = document.querySelectorAll('input[name="method"]');

let chart, currentData = null;
let isLoading = false;
let debTimer  = null;
let currentReportData = null;

// Rapor deƒüi≈ükenleri
let isGeneratingReport = false;

function canLoad(){ return !!selRep.value; }
function setLoading(state){
  isLoading = state;
  meta.textContent = state ? 'Y√ºkleniyor‚Ä¶' : meta.textContent;
}
function debounceLoad(){ clearTimeout(debTimer); debTimer = setTimeout(loadData, 250); }
function selectedMethod(){
  const r = document.querySelector('input[name="method"]:checked');
  return r ? r.value : 'recent';
}

function updateReportButton() {
  const hasRep = !!selRep.value;
  generateReportBtn.disabled = !hasRep || isGeneratingReport;
  
  if (isGeneratingReport) {
    generateReportBtn.innerHTML = '<span class="btn-icon">‚è≥</span><span class="btn-text">Rapor Olu≈üturuluyor...</span>';
  } else if (hasRep) {
    generateReportBtn.innerHTML = '<span class="btn-icon">üìä</span><span class="btn-text">Detaylƒ± Rapor Olu≈ütur</span>';
  } else {
    generateReportBtn.innerHTML = '<span class="btn-icon">üìä</span><span class="btn-text">Temsilci Se√ßin</span>';
  }
}

// Rapor modal fonksiyonlarƒ±
function showReportModal() {
  const modal = document.getElementById('reportModal');
  modal.classList.add('show');
  document.body.style.overflow = 'hidden';
}

function closeReportModal() {
  const modal = document.getElementById('reportModal');
  modal.classList.remove('show');
  document.body.style.overflow = 'auto';
  
  // ƒ∞ndirme butonunu sƒ±fƒ±rla
  const downloadBtn = document.getElementById('downloadReportBtn');
  downloadBtn.disabled = true;
  currentReportData = null;
}

// Rapor olu≈üturma fonksiyonu
async function generateReport() {
  if (!selRep.value || isGeneratingReport) return;
  
  isGeneratingReport = true;
  updateReportButton();
  showReportModal();
  
  const reportBody = document.getElementById('reportBody');
  const reportTitle = document.getElementById('reportModalTitle');
  const downloadBtn = document.getElementById('downloadReportBtn');
  
  reportTitle.textContent = `${selRep.value} - Detaylƒ± Performans Raporu`;
  reportBody.innerHTML = '<div class="loading-spinner"><div>Rapor olu≈üturuluyor...</div></div>';
  downloadBtn.disabled = true;
  
  const params = new URLSearchParams({
    rep: selRep.value,
    date_from: inpF.value || '',
    date_to: inpT.value || '',
    survey_type: '' // T√ºm anket t√ºrlerini dahil et
  });
  
  try {
    const response = await fetch(`/api/generate-report?${params.toString()}`);
    const data = await response.json();
    
    if (data.error) {
      throw new Error(data.error);
    }
    
    currentReportData = data;
    renderReport(data);
    downloadBtn.disabled = false;
    
  } catch (error) {
    console.error('Rapor olu≈üturma hatasƒ±:', error);
    reportBody.innerHTML = `
      <div class="report-section">
        <div class="text-center text-red-600">
          <h3>Rapor olu≈üturulamadƒ±</h3>
          <p>${error.message || 'Bilinmeyen hata'}</p>
        </div>
      </div>`;
  } finally {
    isGeneratingReport = false;
    updateReportButton();
  }
}

function renderReport(data) {
  const reportBody = document.getElementById('reportBody');
  
  let html = `
    <!-- Rapor Bilgileri -->
    <div class="report-section">
      <div class="report-section-title">Rapor Bilgileri</div>
      <div class="stats-grid-report">
        <div class="stat-card-report">
          <div class="stat-value-report">${data.rep_name}</div>
          <div class="stat-label-report">Temsilci</div>
        </div>
        <div class="stat-card-report">
          <div class="stat-value-report">${data.date_range.from} - ${data.date_range.to}</div>
          <div class="stat-label-report">Tarih Aralƒ±ƒüƒ±</div>
        </div>
        <div class="stat-card-report">
          <div class="stat-value-report">${data.generated_at}</div>
          <div class="stat-label-report">Olu≈üturma Tarihi</div>
        </div>
      </div>
    </div>

    <!-- Temel ƒ∞statistikler -->
    <div class="report-section">
      <div class="report-section-title">Genel Performans √ñzeti</div>
      <div class="stats-grid-report">
        <div class="stat-card-report">
          <div class="stat-value-report">${data.basic_stats.total_evaluations || 0}</div>
          <div class="stat-label-report">Toplam Deƒüerlendirme</div>
        </div>
        <div class="stat-card-report">
          <div class="stat-value-report">${(data.basic_stats.avg_performance || 0).toFixed(1)}%</div>
          <div class="stat-label-report">Ortalama Performans</div>
        </div>
        <div class="stat-card-report">
          <div class="stat-value-report">${(data.basic_stats.max_performance || 0).toFixed(1)}%</div>
          <div class="stat-label-report">En Y√ºksek Performans</div>
        </div>
        <div class="stat-card-report">
          <div class="stat-value-report">${(data.basic_stats.min_performance || 0).toFixed(1)}%</div>
          <div class="stat-label-report">En D√º≈ü√ºk Performans</div>
        </div>
        <div class="stat-card-report">
          <div class="stat-value-report">${data.basic_stats.unique_visits || 0}</div>
          <div class="stat-label-report">Benzersiz Ziyaret</div>
        </div>
      </div>
    </div>`;

  // Trend analizi
  if (data.trend_analysis) {
    const trend = data.trend_analysis;
    const trendClass = trend.trend === 'pozitif' ? 'trend-positive' : trend.trend === 'negatif' ? 'trend-negative' : 'trend-stable';
    const trendIcon = trend.trend === 'pozitif' ? 'üìà' : trend.trend === 'negatif' ? 'üìâ' : 'üìä';
    
    html += `
    <div class="report-section">
      <div class="report-section-title">Geli≈üim Analizi</div>
      <div class="stats-grid-report">
        <div class="stat-card-report">
          <div class="stat-value-report">${trend.first_half_avg}%</div>
          <div class="stat-label-report">ƒ∞lk Yarƒ± Ortalama</div>
        </div>
        <div class="stat-card-report">
          <div class="stat-value-report">${trend.second_half_avg}%</div>
          <div class="stat-label-report">Son Yarƒ± Ortalama</div>
        </div>
        <div class="stat-card-report">
          <div class="stat-value-report">
            ${trend.improvement > 0 ? '+' : ''}${trend.improvement}%
            <br>
            <span class="trend-indicator ${trendClass}">
              ${trendIcon} ${trend.trend}
            </span>
          </div>
          <div class="stat-label-report">Geli≈üim</div>
        </div>
      </div>
    </div>`;
  }

  // Kategori performansƒ±
  if (data.category_performance && Object.keys(data.category_performance).length > 0) {
    html += `<div class="report-section">
      <div class="report-section-title">Kategori Performanslarƒ±</div>
      <div class="category-performance">`;
    
    for (const [surveyType, categories] of Object.entries(data.category_performance)) {
      const surveyName = surveyType === 'eczane' ? 'Eczane Anketleri' : 'Doktor Anketleri';
      html += `
        <div class="category-chart-container">
          <div class="category-chart-title">${surveyName}</div>
          <canvas class="category-radar" id="categoryChart_${surveyType}"></canvas>
        </div>`;
    }
    
    html += `</div></div>`;
  }

  // Son ziyaretler
  if (data.recent_visits && data.recent_visits.length > 0) {
    html += `
    <div class="report-section">
      <div class="report-section-title">Son Ziyaretler</div>
      <table class="visits-table">
        <thead>
          <tr>
            <th>Tarih</th>
            <th>Hedef</th>
            <th>T√ºr</th>
            <th>Brick</th>
            <th>Performans</th>
            <th>Durum</th>
          </tr>
        </thead>
        <tbody>`;
    
    data.recent_visits.forEach(visit => {
      const target = visit.survey_type === 'eczane' ? visit.pharmacy_name : visit.doctor_name;
      const badgeClass = visit.percentage >= 90 ? 'badge-excellent' : visit.percentage >= 70 ? 'badge-good' : 'badge-needs-improvement';
      const status = visit.percentage >= 90 ? 'M√ºkemmel' : visit.percentage >= 70 ? 'ƒ∞yi' : 'Geli≈ümeli';
      
      html += `
        <tr>
          <td>${visit.created_at.substring(0, 10)}</td>
          <td>${target || '-'}</td>
          <td>${visit.survey_type === 'eczane' ? 'Eczane' : 'Doktor'}</td>
          <td>${visit.brick_name || '-'}</td>
          <td>${visit.percentage.toFixed(0)}%</td>
          <td><span class="performance-badge ${badgeClass}">${status}</span></td>
        </tr>`;
    });
    
    html += `</tbody></table></div>`;
  }

  reportBody.innerHTML = html;
  
  // Kategori radarlarƒ±nƒ± √ßiz
  setTimeout(() => {
    if (data.category_performance) {
      for (const [surveyType, categories] of Object.entries(data.category_performance)) {
        drawCategoryRadar(surveyType, categories);
      }
    }
  }, 100);
}

function drawCategoryRadar(surveyType, categories) {
  const canvas = document.getElementById(`categoryChart_${surveyType}`);
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: categories.map(cat => cat.category),
      datasets: [{
        label: 'Performans (%)',
        data: categories.map(cat => cat.score),
        fill: true,
        backgroundColor: 'rgba(24, 92, 38, 0.2)',
        borderColor: 'rgba(24, 92, 38, 1)',
        pointBackgroundColor: 'rgba(24, 92, 38, 1)',
        pointBorderColor: '#fff',
        pointHoverBackgroundColor: '#fff',
        pointHoverBorderColor: 'rgba(24, 92, 38, 1)',
        borderWidth: 2,
        pointRadius: 3
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        r: {
          angleLines: { display: true },
          suggestedMin: 0,
          suggestedMax: 100,
          ticks: { stepSize: 20 }
        }
      },
      plugins: {
        legend: { display: false }
      }
    }
  });
}

async function downloadReport() {
  if (!currentReportData || !selRep.value) return;
  
  const downloadBtn = document.getElementById('downloadReportBtn');
  const originalContent = downloadBtn.innerHTML;
  
  downloadBtn.innerHTML = '<span>‚è≥</span> ƒ∞ndiriliyor...';
  downloadBtn.disabled = true;
  
  try {
    const params = new URLSearchParams({
      rep: selRep.value,
      date_from: inpF.value || '',
      date_to: inpT.value || '',
      survey_type: ''
    });
    
    const response = await fetch(`/api/download-report?${params.toString()}`);
    
    if (!response.ok) {
      throw new Error('ƒ∞ndirme hatasƒ±');
    }
    
    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = url;
    a.download = `${selRep.value}_rapor_${new Date().toISOString().split('T')[0]}.pdf`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
    
  } catch (error) {
    console.error('ƒ∞ndirme hatasƒ±:', error);
    alert('Rapor indirilemedi. L√ºtfen tekrar deneyin.');
  } finally {
    downloadBtn.innerHTML = originalContent;
    downloadBtn.disabled = false;
  }
}

// Event listeners
generateReportBtn.addEventListener('click', () => {
  if (!selRep.value) return;
  // Otomatik olarak detaylƒ± rapora git
  const repName = encodeURIComponent(selRep.value);
  window.location.href = `detayli-rapor?rep=${repName}`;
});


// Mevcut kod devam ediyor...
function getMethodName(method) {
  const names = { 
    traditional:'Geleneksel', 
    recent:'Mevcut Durum', 
    weighted:'Tarih Aƒüƒ±rlƒ±klƒ±', 
    trend:'Geli≈üim Trendi', 
    target:'Hedefe Yakƒ±nlƒ±k' 
  };
  return names[method] || method;
}

function getMethodDescription(method) {
  const descriptions = {
    traditional:'T√ºm ge√ßmi≈ü anketlerin (eczane + doktor) aƒüƒ±rlƒ±klƒ± ortalamasƒ± kullanƒ±lƒ±r.',
    recent:'Sadece son 7 anketin (eczane + doktor) ortalamasƒ± alƒ±nƒ±r. Mevcut performansƒ± g√∂sterir.',
    weighted:'T√ºm anketler (eczane + doktor) hesaba katƒ±lƒ±r, ancak yeni anketler daha aƒüƒ±r sayƒ±lƒ±r.',
    trend:'ƒ∞lk yarƒ± ile son yarƒ± anketler (eczane + doktor) kar≈üƒ±la≈ütƒ±rƒ±lƒ±r. Geli≈üimi g√∂sterir.',
    target:'Her kategori i√ßin belirlenen hedeflere yakƒ±nlƒ±k √∂l√ß√ºl√ºr. T√ºm anket t√ºrleri dahil.'
  };
  return descriptions[method] || '';
}

function getMethodColor(method, alpha){
  const colors = {
    traditional:`rgba(75,85,99,${alpha})`,
    recent:`rgba(34,197,94,${alpha})`,
    weighted:`rgba(59,130,246,${alpha})`,
    trend:`rgba(168,85,247,${alpha})`,
    target:`rgba(239,68,68,${alpha})`
  };
  return colors[method] || `rgba(34,197,94,${alpha})`;
}

document.addEventListener('DOMContentLoaded', () => {
  loadRepresentatives();
});

function loadRepresentatives() {
  if (!CURRENT_MANAGER || !MAP[CURRENT_MANAGER]) {
    meta.textContent = 'M√ºd√ºr bilgisi bulunamadƒ±.';
    return;
  }
  
  const representatives = MAP[CURRENT_MANAGER];
  selRep.innerHTML = '<option value="" disabled selected>Temsilci se√ßiniz</option>';
  
  representatives.forEach(rep => {
    const option = document.createElement('option');
    option.value = rep;
    option.textContent = rep;
    selRep.appendChild(option);
  });
  
  if (representatives.length === 0) {
    meta.textContent = 'Bu m√ºd√ºre baƒülƒ± temsilci bulunamadƒ±.';
  } else {
    meta.textContent = 'Temsilci se√ßin.';
  }
}

selRep.addEventListener('change', () => {
  meta.textContent = 'Temsilci se√ßildi.';
  chartTitle.textContent = `${selRep.value} - Birle≈üik Anket Analizi`;
  updateReportButton();
  debounceLoad();
});

[inpF, inpT].forEach(el => el.addEventListener('change', debounceLoad));

methodCards.forEach(card => {
  card.addEventListener('click', () => {
    methodCards.forEach(c => c.classList.remove('method-selected'));
    card.classList.add('method-selected');
    document.getElementById(`method-${card.dataset.method}`).checked = true;
    // Burada method deƒüi≈üikliƒüine g√∂re grafiƒüi yeniden √ßizme fonksiyonunu √ßaƒüƒ±r
    debounceLoad();
  });
});

methodRadios.forEach(radio => {
  radio.addEventListener('change', (e) => {
    updateMethodSelection(e.target.value);
    if (canLoad()) debounceLoad();
  });
});

function updateMethodSelection(method) {
  methodCards.forEach(card => {
    card.classList.toggle('method-selected', card.dataset.method === method);
  });
  methodDetails.classList.add('hidden');
  document.getElementById('trendInfo').classList.add('hidden');
  document.getElementById('targetInfo').classList.add('hidden');
}

async function loadData(){
  if (!canLoad() || isLoading) return;
  
  const rep    = selRep.value;
  const f      = inpF.value;
  const t      = inpT.value;
  const method = selectedMethod();
  
  const params = new URLSearchParams({ rep, method, survey_type: "doktor" });
  if (CURRENT_MANAGER) params.set('manager', CURRENT_MANAGER);
  if (f)   params.set('date_from', f);
  if (t)   params.set('date_to', t);
  
  setLoading(true);
  meta.textContent = 'Y√ºkleniyor‚Ä¶';
  
  try{
    const res = await fetch('/api/rep-radar?' + params.toString());
    const js  = await res.json();
    if (js.error){ 
      meta.textContent = 'Hata: ' + js.error; 
      return; 
    }
    
    currentData = js;
    updateMetaInfo(js);
    updateMethodDetails(js);
    updateChart(js, rep, method);
    
  }catch(err){
    console.error('API Error:', err);
    meta.textContent = 'API hatasƒ±: ' + (err?.message || err);
  }finally{
    setLoading(false);
  }
}

function updateMetaInfo(data) {
  let metaText = '';
  if (data.samples){
    metaText = `√ñrnek sayƒ±sƒ±: ${data.samples} (Birle≈üik Anketler)`;
    if (data.last_eval_at) metaText += ` ‚Ä¢ Son kayƒ±t: ${data.last_eval_at.replace('T',' ')}`;
    if (data.method && data.method !== 'traditional'){
      metaText += ` ‚Ä¢ Y√∂ntem: ${getMethodName(data.method)}`;
    }
  } else {
    metaText = 'Kayƒ±t bulunamadƒ±';
  }
  meta.textContent = metaText;
}

function updateMethodDetails(data){
  const method = data.method || 'traditional';
  document.getElementById('methodTitle').textContent = getMethodName(method);
  document.getElementById('methodDescription').textContent = getMethodDescription(method);
  
  if (method === 'trend' && data.improvement && !data.insufficient_data){
    document.getElementById('trendInfo').classList.remove('hidden');
    if (data.early_period){
      document.getElementById('earlyPeriod').textContent = `${data.early_period.from} - ${data.early_period.to}`;
    }
    if (data.recent_period){
      document.getElementById('recentPeriod').textContent = `${data.recent_period.from} - ${data.recent_period.to}`;
    }
    const avgImprovement = data.improvement.reduce((a,b)=>a+b,0) / data.improvement.length;
    document.getElementById('overallImprovement').textContent = `${avgImprovement.toFixed(1)}%`;
    const maxImprovementIdx = data.improvement.indexOf(Math.max(...data.improvement));
    document.getElementById('bestImproved').textContent =
      `${(data.labels || COMBINED_CATEGORIES)[maxImprovementIdx]} (+${data.improvement[maxImprovementIdx]}%)`;
  }
  
  if (method === 'target' && data.average_achievement){
    document.getElementById('targetInfo').classList.remove('hidden');
    document.getElementById('avgAchievement').textContent = `${data.average_achievement}%`;
    document.getElementById('categoriesAtTarget').textContent =
      `${data.categories_at_target || 0} / ${(data.labels || COMBINED_CATEGORIES).length}`;
  }
  
  methodDetails.classList.remove('hidden');
}

function updateChart(data, repName, method){
  const chartData = {
    labels: data.labels || COMBINED_CATEGORIES,
    datasets: [{
      label: `${repName} (Birle≈üik)`,
      data: data.data || COMBINED_CATEGORIES.map(()=>0),
      fill: true,
      backgroundColor: getMethodColor(method, 0.2),
      borderColor: getMethodColor(method, 1),
      pointBackgroundColor: getMethodColor(method, 1),
      pointBorderColor: '#fff',
      pointHoverBackgroundColor: '#fff',
      pointHoverBorderColor: getMethodColor(method, 1),
      borderWidth: 3,
      pointRadius: 4,
      pointHoverRadius: 6
    }]
  };

  if (method === 'target' && data.targets){
    chartData.datasets.push({
      label: 'Hedefler',
      data: data.targets,
      fill: false,
      backgroundColor: 'rgba(239,68,68,0.1)',
      borderColor: 'rgba(239,68,68,0.8)',
      pointBackgroundColor: 'rgba(239,68,68,0.8)',
      pointBorderColor: '#fff',
      borderWidth: 2,
      pointRadius: 3,
      borderDash: [5,5]
    });
  }

  if (method === 'trend' && data.early_scores && !data.insufficient_data){
    chartData.datasets.push({
      label: 'ƒ∞lk D√∂nem (Birle≈üik)',
      data: data.early_scores,
      fill: false,
      backgroundColor: 'rgba(156,163,175,0.2)',
      borderColor: 'rgba(156,163,175,0.8)',
      pointBackgroundColor: 'rgba(156,163,175,0.8)',
      pointBorderColor: '#fff',
      borderWidth: 2,
      pointRadius: 3,
      borderDash: [3,3]
    });
  }

  const config = {
    type: 'radar',
    data: chartData,
    options: {
      responsive: true,
      maintainAspectRatio: false,
      elements: { 
        line: { tension: 0.2 }, 
        point: { hoverRadius: 8 } 
      },
      scales: {
        r: {
          angleLines: { display:true, color:'rgba(0,0,0,0.1)' },
          suggestedMin: 0, 
          suggestedMax: 100,
          ticks: { 
            stepSize: 20, 
            showLabelBackdrop: false, 
            font: { size: window.innerWidth < 768 ? 9 : 10 }, 
            color: '#6B7280' 
          },
          pointLabels: { 
            font: { 
              size: window.innerWidth < 768 ? 11 : 12, 
              weight: '600' 
            }, 
            color: '#374151' 
          },
          grid: { color:'rgba(0,0,0,0.05)' }
        }
      },
      plugins: {
        legend: {
          display: true, 
          position: 'top',
          labels: { 
            usePointStyle: true, 
            padding: window.innerWidth < 768 ? 15 : 20, 
            font: { size: window.innerWidth < 768 ? 11 : 12 } 
          }
        },
        tooltip: {
          callbacks: {
            label: function(ctx){
              let label = ctx.dataset.label + ': ' + ctx.parsed.r.toFixed(1) + '%';
              if (method === 'trend' && ctx.datasetIndex === 0 && data.improvement){
                const imp = data.improvement[ctx.dataIndex];
                if (imp > 0) label += ` (‚Üó +${imp}%)`;
                else if (imp < 0) label += ` (‚Üò ${imp}%)`;
              }
              if (method === 'target' && ctx.datasetIndex === 0 && data.achievement){
                label += ` (Hedef: ${data.achievement[ctx.dataIndex]}%)`;
              }
              return label;
            }
          }
        }
      }
    }
  };

  if (chart) chart.destroy();
  const ctx = document.getElementById('radar').getContext('2d');
  chart = new Chart(ctx, config);
}

// Modal dƒ±≈üƒ±nda tƒ±klanƒ±nca kapat
document.addEventListener('click', function(event) {
  const modal = document.getElementById('reportModal');
  const reportContent = document.querySelector('.report-content');
  
  if (modal.classList.contains('show') && !reportContent.contains(event.target)) {
    closeReportModal();
  }
});

// ESC tu≈üu ile modal'ƒ± kapat
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    const modal = document.getElementById('reportModal');
    if (modal.classList.contains('show')) {
      closeReportModal();
    }
  }
});

updateMethodSelection('recent');
updateReportButton();
</script>

<!-- Ana CSS stilleri eklenecek - originalinizden kopyalayƒ±n -->
<style>
/* Container ve responsive d√ºzeltmeleri */
body {
  margin: 0;
  padding: 0;
  overflow-x: hidden;
}

.container {
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
}

.date-input { 
  position: relative; 
  width: 100%;
}
.date-input input[type="date"]{
  width: 100%;
  min-height: 48px;
  padding: 8px 12px;
  padding-right: 40px;
  border: 1px solid #e5e7eb; 
  border-radius: 8px;
  background: #fff;
  font-size: 14px;
  box-sizing: border-box;
}
.date-input input[type="date"]::-webkit-date-and-time-value { text-align: left; }
.date-input input[type="date"]::-webkit-calendar-picker-indicator{
  opacity: .75; 
  cursor: pointer;
}

.controls { 
  display: flex; 
  gap: 12px; 
  flex-wrap: wrap; 
  margin-bottom: 1rem; 
  align-items: center; 
  width: 100%;
}
.controls .meta { 
  margin-left: auto; 
  color: #4b5563; 
  font-size: 0.9rem;
  flex-shrink: 0;
}

/* Survey Type Info */
.survey-type-info {
  background: linear-gradient(135deg, #11461c, #11461c);
  color: white;
  padding: 12px 16px;
  border-radius: 12px;
  margin-bottom: 16px;
  text-align: center;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

/* Method Details */
#methodDetails {
  background: rgba(3,47,12,0.05) !important;
  border: 1px solid rgba(3,47,12,0.2) !important;
  margin-bottom: 16px;
}

/* RESPONSIVE GRID LAYOUT */
.main-content-grid {
  display: grid;
  gap: 20px;
  align-items: start;
  margin: 20px 0;
  width: 100%;
  max-width: 100%;
}

/* Desktop: Radar 3fr, Method 2fr */
@media (min-width: 1200px) {
  .main-content-grid {
    grid-template-columns: 3fr 2fr;
    gap: 32px;
  }
}

/* Tablet: tek s√ºtun, method √ºstte */
@media (max-width: 1199px) {
  .main-content-grid {
    grid-template-columns: 1fr;
    gap: 20px;
  }
  
  .categories-section {
    order: 1;
  }
  
  .chart-section {
    order: 2;
  }
}

/* Chart section - RESPONSIVE (SOL TARAF - 3FR) */
.chart-section {
  background: #f8fafc;
  padding: 16px;
  border-radius: 16px;
  border: 3px solid #032f0c;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}

.chart-wrapper {
  background: white;
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}

.chart-title {
  text-align: center;
  font-weight: 700;
  font-size: 18px;
  color: #032f0c;
  margin-bottom: 16px;
}

/* RADAR CANVAS - RESPONSIVE */
#radar {
  width: 100% !important;
  max-width: 100% !important;
  height: auto !important;
}

.chart-container {
  position: relative;
  width: 100%;
  height: 400px;
  max-width: 100%;
}

/* Categories section - RESPONSIVE (SAƒû TARAF - 2FR) */
.categories-section {
  background: #f9fafb;
  padding: 20px;
  border-radius: 16px;
  border: 2px solid #e5e7eb;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}

.categories-title {
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 20px;
  text-align: center;
}

/* Method cards - RESPONSIVE GRID */
.method-cards-vertical {
  display: grid;
  gap: 12px;
  width: 100%;
}

/* Desktop: tek s√ºtun */
@media (min-width: 1200px) {
  .method-cards-vertical {
    grid-template-columns: 1fr;
  }
}

/* Tablet: 2 s√ºtun */
@media (min-width: 768px) and (max-width: 1199px) {
  .method-cards-vertical {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .chart-container {
    height: 350px;
  }
}

/* Mobil: tek s√ºtun */
@media (max-width: 767px) {
  .method-cards-vertical {
    grid-template-columns: 1fr;
  }
  
  .chart-container {
    height: 300px;
  }
}

.method-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px;
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  width: 100%;
  box-sizing: border-box;
}

.method-card:hover {
  border-color: #032f0c;
  box-shadow: 0 2px 8px rgba(3,47,12,0.1);
}

.method-card.method-selected{
  border: 2px solid #032f0c;
  box-shadow: 0 2px 10px rgba(3,47,12,0.15);
  background: rgba(3,47,12,0.05);
}

.method-icon {
  font-size: 20px;
  flex-shrink: 0;
}

.method-content {
  flex: 1;
  min-width: 0;
}

.method-name {
  font-weight: 600;
  font-size: 15px;
  color: #1f2937;
  margin-bottom: 2px;
}

.method-desc {
  font-size: 13px;
  color: #6b7280;
  line-height: 1.3;
}

.method-radio {
  flex-shrink: 0;
}

.method-radio input[type="radio"] {
  width: 16px;
  height: 16px;
}

/* MOBƒ∞L RESPONSIVE */
@media (max-width: 768px) {
  body {
    font-size: 14px;
  }
  
  .controls {
    flex-direction: column;
    gap: 8px;
    align-items: stretch;
  }
  
  .controls .meta {
    margin-left: 0;
    text-align: center;
    margin-top: 8px;
  }
  
  .method-card {
    flex-direction: row;
    padding: 12px;
    gap: 10px;
  }
  
  .method-name {
    font-size: 14px;
  }
  
  .method-desc {
    font-size: 12px;
  }
  
  .chart-title {
    font-size: 16px;
  }
  
  .categories-title {
    font-size: 16px;
  }
  
  .date-input input[type="date"] {
    font-size: 13px;
    padding: 6px 10px;
    padding-right: 35px;
    min-height: 42px;
  }
  
  .date-input label {
    font-size: 13px;
  }
}

/* ULTRA K√ú√á√úK EKRANLAR */
@media (max-width: 480px) {
  .chart-container {
    height: 280px;
  }
  
  .method-card {
    padding: 10px;
    gap: 8px;
  }
  
  .method-icon {
    font-size: 18px;
  }
  
  .method-name {
    font-size: 13px;
  }
  
  .method-desc {
    font-size: 11px;
  }
}

/* Grid sistem d√ºzeltmeleri */
.grid {
  display: grid;
  width: 100%;
  max-width: 100%;
}

.gap-4 {
  gap: 1rem;
}

.gap-3 {
  gap: 0.75rem;
}

.grid-cols-2 {
  grid-template-columns: 1fr 1fr;
}

@media (min-width: 768px) {
  .md\\:grid-cols-2 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

/* Input ve select responsive */
select, input[type="date"] {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}
</style>
{% endblock %}